<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="vertikal">
<meta name="dcterms.date" content="2023-08-03">
<meta name="description" content="How I deeply process telco customer churn dataset.">

<title>Vertikal Willis - Telco customer churn</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


<link rel="stylesheet" href="../../assets/ek-styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">VERTIKAL W.<span class="icon-line"></span></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">portfolios</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.qmd" rel="" target="">
 <span class="menu-text">tutorials</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Telco customer churn analysis</h1>
                  <div>
        <div class="description">
          How I deeply process telco customer churn dataset.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">classification</div>
                <div class="quarto-category">machine-learning</div>
                <div class="quarto-category">data-science</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>vertikal </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 3, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section"></a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents">Table Of Contents</a></li>
  <li><a href="#data-introduction" id="toc-data-introduction" class="nav-link" data-scroll-target="#data-introduction">Data Introduction</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#basic-exploratory-data-analysis." id="toc-basic-exploratory-data-analysis." class="nav-link" data-scroll-target="#basic-exploratory-data-analysis.">Basic Exploratory Data Analysis.</a>
  <ul class="collapse">
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics">Descriptive Statistics</a></li>
  <li><a href="#univariate-analysis" id="toc-univariate-analysis" class="nav-link" data-scroll-target="#univariate-analysis">Univariate Analysis</a></li>
  <li><a href="#multivariate-analysis" id="toc-multivariate-analysis" class="nav-link" data-scroll-target="#multivariate-analysis">Multivariate Analysis</a></li>
  </ul></li>
  <li><a href="#deep-dive-exploratory-data-analysis" id="toc-deep-dive-exploratory-data-analysis" class="nav-link" data-scroll-target="#deep-dive-exploratory-data-analysis">Deep-Dive Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#services-internetservice-analysis" id="toc-services-internetservice-analysis" class="nav-link" data-scroll-target="#services-internetservice-analysis">Services &amp; InternetService analysis</a></li>
  <li><a href="#monthlycharges-analysis" id="toc-monthlycharges-analysis" class="nav-link" data-scroll-target="#monthlycharges-analysis">MonthlyCharges analysis</a></li>
  <li><a href="#customer-analysis" id="toc-customer-analysis" class="nav-link" data-scroll-target="#customer-analysis">Customer analysis</a></li>
  <li><a href="#benefits-analysis" id="toc-benefits-analysis" class="nav-link" data-scroll-target="#benefits-analysis">Benefits analysis</a></li>
  <li><a href="#churn-analysis" id="toc-churn-analysis" class="nav-link" data-scroll-target="#churn-analysis">Churn analysis</a></li>
  </ul></li>
  <li><a href="#modelling" id="toc-modelling" class="nav-link" data-scroll-target="#modelling">Modelling</a>
  <ul class="collapse">
  <li><a href="#feature-selection-encoding" id="toc-feature-selection-encoding" class="nav-link" data-scroll-target="#feature-selection-encoding">Feature selection &amp; encoding</a></li>
  <li><a href="#splits-data-and-define-custom-function" id="toc-splits-data-and-define-custom-function" class="nav-link" data-scroll-target="#splits-data-and-define-custom-function">Splits data and define custom function</a></li>
  <li><a href="#model-building-1-hyperparameter-tuning-threshold-tuning" id="toc-model-building-1-hyperparameter-tuning-threshold-tuning" class="nav-link" data-scroll-target="#model-building-1-hyperparameter-tuning-threshold-tuning">Model building 1 / Hyperparameter tuning + threshold tuning</a></li>
  <li><a href="#model-building-2-hyperparameter-tuning-threshold-tuning-smote" id="toc-model-building-2-hyperparameter-tuning-threshold-tuning-smote" class="nav-link" data-scroll-target="#model-building-2-hyperparameter-tuning-threshold-tuning-smote">Model building 2 / Hyperparameter tuning + threshold tuning + SMOTE</a></li>
  <li><a href="#model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight" id="toc-model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight" class="nav-link" data-scroll-target="#model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight">Model building 3 / Hyperparameter tuning + threshold tuning + custom weight</a></li>
  </ul></li>
  <li><a href="#model-interpretation" id="toc-model-interpretation" class="nav-link" data-scroll-target="#model-interpretation">Model Interpretation</a>
  <ul class="collapse">
  <li><a href="#partial-dependence-plot-pdp-individual-conditional-expectation-ice" id="toc-partial-dependence-plot-pdp-individual-conditional-expectation-ice" class="nav-link" data-scroll-target="#partial-dependence-plot-pdp-individual-conditional-expectation-ice">Partial dependence plot (PDP) &amp; Individual conditional expectation (ICE)</a></li>
  <li><a href="#confidence-level-based-on-trees-standard-deviation-and-confidence-interval." id="toc-confidence-level-based-on-trees-standard-deviation-and-confidence-interval." class="nav-link" data-scroll-target="#confidence-level-based-on-trees-standard-deviation-and-confidence-interval.">Confidence level based on trees’ standard deviation and confidence interval.</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="https://drive.google.com/drive/folders/1MfhjAzv20ACfjat73BC0Hfi4cFgb7Koj?usp=sharing"><i class="bi bi-journal-code"></i>Download files</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>On this occasion, I would like to discuss one of my projects that involves the telco customer churn dataset. Who doesn’t know about telco customer churn? This dataset is exceedingly common, and I’m confident that every data science practitioner has worked with it at some point. So, why am I still using this dataset? It’s because I want to demonstrate a different and more detailed approach on how to process it. Here, I will conduct a deeper Exploratory Data Analysis (EDA) and showcase how to create and fine-tune a machine learning model to align it with the intended business objectives, followed by interpreting the results.</p>
<p>Of course, the goals of this project are to produce actionable insights and the most suitable predictive model aligned with the existing business concepts. On this particular blog post, I will show detailed step by step on how to do the projects (including the codes) so this will be very technical, but if you just want to see the big picture you can visit this link:</p>
<p>Presentation link : <a href="https://docs.google.com/presentation/d/e/2PACX-1vR0dOy0icSQtH47y4pXOvki-xwIL4wtljaLZkL_NXMp5fN2sBzJlLuYRaGY5SWqew/pub?start=true&amp;loop=false&amp;delayms=60000">Click here</a></p>
<div style="font-size: 90%;">
<section id="section" class="level1 quarto-embed-nb-cell">
<h1></h1>
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table Of Contents</h2>
<p>• Data Introduction <br> • Data Preparation (Import libraries, data cleaning &amp; data wrangling)<br> • Basic exploratory data analysis <br> &nbsp;&nbsp;&nbsp; • Descriptive statistic <br> &nbsp;&nbsp;&nbsp; • Univariate analysis <br> &nbsp;&nbsp;&nbsp; • Multivariate analysis <br> • Deep exploratory data analysis <br> &nbsp;&nbsp;&nbsp; • Services and internet services analysis <br> &nbsp;&nbsp;&nbsp; • Monthly charges analysis <br> &nbsp;&nbsp;&nbsp; • Customer analysis <br> &nbsp;&nbsp;&nbsp; • Benefits analysis <br> &nbsp;&nbsp;&nbsp; • Churn analysis <br> • Modelling<br> &nbsp;&nbsp;&nbsp; • Features selection and encoding <br> &nbsp;&nbsp;&nbsp; • Splits data and define custom metrics <br> &nbsp;&nbsp;&nbsp; • Model building combination 1 <br> &nbsp;&nbsp;&nbsp; • Model building combination 2 <br> &nbsp;&nbsp;&nbsp; • Model building combination 3<br>
• Model interpretation<br> &nbsp;&nbsp;&nbsp; • PDP and ICE plots <br> &nbsp;&nbsp;&nbsp; • Checking prediction’s confidence using confidence interval <br></p>
</section>
<section id="data-introduction" class="level2">
<h2 class="anchored" data-anchor-id="data-introduction">Data Introduction</h2>
<p>This dataset contain informations about customers that churn and not churned in a telco company. Below is the column informations:<br> 1.customerID = customer unique ID.<br> 2.gender = customer gender (M/F).<br> 3.SeniorCitizen = old / young customer.<br> 4.Partner = either a customer has partners or not.<br> 5.Dependents = either a customer has dependents or not.<br> 6.tenure = how long the customer subscribed (in month).<br> 7.MultipleLines = either a customer using multiple lines or not (phone lines).<br> 8.InternetService = either a customer using InternetService lines or not.<br> 9.OnlineSecurity = either a customer has OnlineSecurity or not.<br> 10.OnlineBackup = either a customer has OnlineBackup or not.<br> 11.DeviceProtection = either a customer has DeviceProtection or not.<br> 12.TechSupport = either a customer has TechSupport or not.<br> 13.StreamingTV = either a customer has StreamingTV or not.<br> 14.StreamingMovies = either a customer has StreamingMovie or not.<br> 15.Contract = types of contract.<br> 16.PaperlessBilling = either a customer has PaperlessBilling or not.<br> 17.PaymentMethod = types of the payment method.<br> 18.MonthlyCharges = how much charges per month.<br> 19.TotalCharges = total charges of all time.<br> 20.Churn = either a customer churn or not.<br> 21.Hobby = customer hobby.<br><br></p>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<div class="cell" data-execution_count="208">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gaussian_kde</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pdpbox <span class="im">import</span> pdp, info_plots</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">'darkgrid'</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> <span class="dv">300</span> <span class="co">#set figure dpi</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>() <span class="co">#set figure styling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359104,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="2366b164-8324-46c7-b7df-c285928418ef" data-execution_count="210">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#import dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'telco.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="210">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Hobby</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7590-VHVEG</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>135</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>29.85</td>
<td>29.85</td>
<td>No</td>
<td>Swimming</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5575-GNVDE</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>34</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>One year</td>
<td>No</td>
<td>Mailed check</td>
<td>56.95</td>
<td>1889.5</td>
<td>No</td>
<td>Running</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3668-QPYBK</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>140</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Mailed check</td>
<td>53.85</td>
<td>7560</td>
<td>Yes</td>
<td>Hiking</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7795-CFOCW</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>136</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>One year</td>
<td>No</td>
<td>Bank transfer (automatic)</td>
<td>42.45</td>
<td>1840.75</td>
<td>No</td>
<td>Swimming</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9237-HQITU</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>70.70</td>
<td>151.65</td>
<td>Yes</td>
<td>Running</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:23,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3767453b-34e8-4162-c1ae-4b31e4af10ad" data-execution_count="211">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#take a look at the dataframe</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7043 entries, 0 to 7042
Data columns (total 22 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   customerID        7043 non-null   object 
 1   gender            7043 non-null   object 
 2   SeniorCitizen     7043 non-null   int64  
 3   Partner           7043 non-null   object 
 4   Dependents        7043 non-null   object 
 5   tenure            7043 non-null   int64  
 6   PhoneService      7043 non-null   object 
 7   MultipleLines     7043 non-null   object 
 8   InternetService   7043 non-null   object 
 9   OnlineSecurity    7043 non-null   object 
 10  OnlineBackup      7043 non-null   object 
 11  DeviceProtection  6627 non-null   object 
 12  TechSupport       7043 non-null   object 
 13  StreamingTV       7043 non-null   object 
 14  StreamingMovies   7043 non-null   object 
 15  Contract          6798 non-null   object 
 16  PaperlessBilling  7043 non-null   object 
 17  PaymentMethod     7043 non-null   object 
 18  MonthlyCharges    7043 non-null   float64
 19  TotalCharges      4859 non-null   object 
 20  Churn             7043 non-null   object 
 21  Hobby             4201 non-null   object 
dtypes: float64(1), int64(2), object(19)
memory usage: 1.2+ MB</code></pre>
</div>
</div>
<p>There are 4 columns with missing values which are DeviceProtection, Contract, TotalCharges and Hobby.</p>
<div class="cell" data-execution_count="212">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#checking percentage of missing values</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>missingkolom <span class="op">=</span> [<span class="st">'DeviceProtection'</span>,<span class="st">'Contract'</span>,<span class="st">'TotalCharges'</span>,<span class="st">'Hobby'</span>]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> missingkolom:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Missing value of column </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> (%) : </span><span class="sc">{</span><span class="bu">round</span>(df[x].isna().<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(df) <span class="op">*</span> <span class="dv">100</span>,<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value of column DeviceProtection (%) : 5.91
Missing value of column Contract (%) : 3.48
Missing value of column TotalCharges (%) : 31.01
Missing value of column Hobby (%) : 40.35</code></pre>
</div>
</div>
<div class="cell" data-execution_count="213">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#impute missing values with univariate imputation by value proportion</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DeviceProtection'</span>] <span class="op">=</span> df[<span class="st">'DeviceProtection'</span>].fillna(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                             pd.Series(np.random.choice([<span class="st">'No'</span>,<span class="st">'Yes'</span>,<span class="st">'No internet service'</span>], </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                             p <span class="op">=</span> <span class="bu">list</span>(df[<span class="st">'DeviceProtection'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)), size<span class="op">=</span><span class="bu">len</span>(df))))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Contract'</span>] <span class="op">=</span> df[<span class="st">'Contract'</span>].fillna(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     pd.Series(np.random.choice([<span class="st">'Month-to-month'</span>,<span class="st">'Two year'</span>,<span class="st">'One year'</span>], </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                     p <span class="op">=</span> <span class="bu">list</span>(df[<span class="st">'Contract'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)), size<span class="op">=</span><span class="bu">len</span>(df))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here I impute DeviceProtection and Contract with univariate imputation by value proportion for the following reasons:<br> 1.The missing values is not that much (&lt;10%).<br> 2.The columns don’t have any relationship with other columns so that multivariate imputation is not possible.<br> 3.Using proportion is more precise in this case rather than use ‘mode’.</p>
<div class="cell" data-execution_count="214">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#delete column Hobby</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'Hobby'</span>],inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Reasons to delete:<br> 1.Missing values is too many.<br> 2.By business context, Hobby doesn’t give enough useful informations.<br> 3.Cannot be imputed by multivariate imputation.<br></p>
<div class="cell" data-execution_count="215">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#impute TotalCharges from tenure and MonthlyCharges</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalCharges'</span>] <span class="op">=</span> df[<span class="st">'TotalCharges'</span>].fillna(df[<span class="st">'tenure'</span>] <span class="op">*</span> df[<span class="st">'MonthlyCharges'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Even this column has so many missing values, I decided to impute it with multivariate imputation because:<br> 1.By business context, TotalCharges is more or less tenure * MonthlyCharges.<br> 2.So even the missing values are high, it can still be imputed with a strong justification.<br></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8424ee92-08be-47c3-b65c-50731eb84dc7" data-execution_count="216">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#there's a space in the total charges column.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.TotalCharges:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">float</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Unable to convert to float with this value : </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  </code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:18,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="cf0d5a83-8763-4971-8f97-54265ea580b8" data-execution_count="217">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df[df.TotalCharges <span class="op">==</span> <span class="st">' '</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="217">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">488</td>
<td>4472-LVYGI</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>One year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>52.55</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">753</td>
<td>3115-CZMZD</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.25</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">936</td>
<td>5709-LVOEQ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>80.85</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1082</td>
<td>4367-NUYAO</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.75</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1334</td>
<td>1768-ZAIFU</td>
<td>Female</td>
<td>1</td>
<td>No</td>
<td>No</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>25.20</td>
<td></td>
<td>Yes</td>
</tr>
</tbody>
</table>

<p>5 rows × 21 columns</p>
</div>
</div>
</div>
<p>When the tenure value is 0, the TotalCharges value is empty (‘space’). This is because customers who have just joined (less than a month) have not been charged yet, resulting in a TotalCharges value of 0. Since there are only 12 rows with this condition, I will delete them.</p>
<div class="cell" data-execution_count="218">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop rows that has empty TotalCharges.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(df.index[df.TotalCharges <span class="op">==</span> <span class="st">' '</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:18,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359106,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="b764d9bd-c07a-4372-a29d-ea323b83ef1e" data-execution_count="219">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check for duplicate data, if True then there's no duplicate.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df.customerID.nunique() <span class="op">==</span> <span class="bu">len</span>(df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="219">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="220">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#feature engineered 2 new features for the sake of easier analysis.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Services'</span>] <span class="op">=</span> df[[<span class="st">'PhoneService'</span>,<span class="st">'InternetService'</span>]].<span class="bu">apply</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                     <span class="kw">lambda</span> x: <span class="st">'Both'</span> <span class="cf">if</span> <span class="bu">list</span>(x).count(<span class="st">'No'</span>) <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Internet Only'</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'No'</span> <span class="cf">else</span> <span class="st">'Phone Only'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalBenefits'</span>] <span class="op">=</span> df.loc[:,<span class="st">'OnlineSecurity'</span>:<span class="st">'StreamingMovies'</span>]<span class="op">\</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                          .<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>New features explanation: <br> 1.Services = Combined values of PhoneService and InternetService.<br> 2.TotalBenefits = Sum of benefits taken on OnlineSecurity until StreamingMovies.</p>
<div class="cell" data-execution_count="221">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Change values of 1 and 0 to 'Yes' and 'No'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'SeniorCitizen'</span>] <span class="op">=</span> df.SeniorCitizen.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Yes'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'No'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Change numerical value to strings for simpler and consistent analysis.</p>
<div class="cell" data-execution_count="222">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop useless column</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'customerID'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="223">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change columns object data type to numerical</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df.tenure <span class="op">=</span> df.tenure.astype(<span class="st">'int64'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df.MonthlyCharges <span class="op">=</span> df.MonthlyCharges.astype(<span class="st">'float64'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>df.TotalCharges <span class="op">=</span> df.TotalCharges.astype(<span class="st">'float64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="224">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#checking values of real totalcharges and calculated totalcharges</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalChargesDiff'</span>] <span class="op">=</span> df[[<span class="st">'tenure'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalCharges'</span>]].<span class="bu">apply</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                             <span class="kw">lambda</span> x: <span class="bu">round</span>(<span class="bu">abs</span>(<span class="dv">1</span> <span class="op">-</span> (x[<span class="dv">0</span>] <span class="op">*</span> x[<span class="dv">1</span>] <span class="op">/</span> x[<span class="dv">2</span>])) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">3</span>), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, I have created a new column called TotalChargesDiff to check the differences (%) between the actual TotalCharges value (from the dataset) and the calculated TotalCharges value (obtained by multiplying tenure with MonthlyCharges). If the difference is above 40%, I will consider those rows as invalid because the values of tenure and MonthlyCharges cannot be trusted.</p>
<div class="cell" data-execution_count="225">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalChargesDiff'</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="225">
<pre><code>0       13400.000
5        1357.404
18        788.048
19        330.214
3         213.633
128        73.511
47         72.615
4631       64.286
5802       63.380
20         58.263
Name: TotalChargesDiff, dtype: float64</code></pre>
</div>
</div>
<p>You can observe that some data points have a TotalChargesDiff that reaches hundreds or even thousands percent.</p>
<div class="cell" data-execution_count="226">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#removing rows that have &gt; 40% TotalChargesDiff.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.TotalChargesDiff <span class="op">&lt;</span> <span class="dv">40</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'TotalChargesDiff'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="227">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numericategoric(df):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> <span class="bu">len</span>(df._get_numeric_data().columns)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    cat <span class="op">=</span> <span class="bu">len</span>(df.columns) <span class="op">-</span> num</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TotalNumericalData = "</span> <span class="op">+</span> <span class="bu">str</span>(num))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TotalCategoricalData = "</span> <span class="op">+</span> <span class="bu">str</span>(cat))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Numerical = "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">list</span>(df._get_numeric_data().columns )))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Categorical = "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">list</span>(df.drop(df._get_numeric_data().columns, axis<span class="op">=</span><span class="dv">1</span>).columns)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:15,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359107,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="6fd750ef-03a5-45c6-8b8f-b5be98c30aec" data-execution_count="228">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>numericategoric(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>TotalNumericalData = 4
TotalCategoricalData = 18
Numerical = ['tenure', 'MonthlyCharges', 'TotalCharges', 'TotalBenefits']
Categorical = ['gender', 'SeniorCitizen', 'Partner', 'Dependents', 'PhoneService', 'MultipleLines', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling', 'PaymentMethod', 'Churn', 'Services']</code></pre>
</div>
</div>
<p>Show numerical and categorical columns</p>
<div class="cell" data-scrolled="true" data-execution_count="229">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#assign categorical and numerical columns on different dataframe for easier analysis.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>dfnum <span class="op">=</span> df._get_numeric_data()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>dfcat <span class="op">=</span> df.drop(columns <span class="op">=</span> dfnum.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="basic-exploratory-data-analysis." class="level2">
<h2 class="anchored" data-anchor-id="basic-exploratory-data-analysis.">Basic Exploratory Data Analysis.</h2>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive Statistics</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:13,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359107,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3189de7c-197e-4764-db1b-f9bfe6d65df0" data-execution_count="230">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#numerical columns describe.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dfnum.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="230">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">TotalBenefits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7012.000000</td>
<td>7012.000000</td>
<td>7012.000000</td>
<td>7012.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>32.506560</td>
<td>64.732760</td>
<td>2286.410207</td>
<td>2.042356</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>24.564234</td>
<td>30.109753</td>
<td>2265.759401</td>
<td>1.835886</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>12.000000</td>
<td>13.500000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>9.000000</td>
<td>35.450000</td>
<td>402.437500</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>29.000000</td>
<td>70.300000</td>
<td>1397.250000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>56.000000</td>
<td>89.850000</td>
<td>3784.125000</td>
<td>3.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>140.000000</td>
<td>118.750000</td>
<td>8684.800000</td>
<td>6.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>1.All columns seems to have a normal min-max values. Nothing weird here.<br> 2.Average tenure is about 30 months which is pretty low.<br> 3.Average MonthlyCharge is about 65-70 USD which is pretty good.<br> 4.Out of 6 benefits available, the average taken by customer is around 2, which is pretty low.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:14,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359108,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a0cb4619-90ed-4ff8-9888-2a3dd67a0abe" data-execution_count="231">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dfcat.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="231">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Services</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>No</td>
<td>Both</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>3542</td>
<td>5874</td>
<td>3624</td>
<td>4920</td>
<td>6336</td>
<td>3372</td>
<td>3087</td>
<td>3486</td>
<td>3075</td>
<td>3066</td>
<td>3459</td>
<td>2798</td>
<td>2769</td>
<td>3850</td>
<td>4155</td>
<td>2354</td>
<td>5155</td>
<td>4821</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>1.Male and Female has the same proportion.<br> 2.Most of customers is non SeniorCitizen with no Partner and No Dependents.<br> 3.Favorite InternetService is Fiber optic.<br> 4.Majority of customers is subscribed with ‘Month-to-month’ Contract.<br> 5.5155 out of 7012 is non-Churn customers which make this dataset is imbalanced.<br> 6.All these columns have low cardiality values.</p>
</section>
<section id="univariate-analysis" class="level3">
<h3 class="anchored" data-anchor-id="univariate-analysis">Univariate Analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4816,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644363913,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="170c154e-b2f7-4f3c-8eaa-b7dba683bd5c" data-execution_count="233">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    axarr[dfnum.columns.get_loc(x)].boxplot(df[x],patch_artist<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    axarr[dfnum.columns.get_loc(x)].set_xlabel(x)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Outliers checking on numeric columns'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Will drop outlier in tenure.</p>
<div class="cell" data-execution_count="234">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop outlier in tenure</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.tenure <span class="op">&lt;</span> <span class="dv">125</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:13,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644363913,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a547964b-2068-41fa-beb9-f5d5f4cdd30a" data-execution_count="235">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot distribution for numerical columns</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>dfnum[x], </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'skyblue'</span>, </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                 kde<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 edgecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>axarr[dfnum.columns.get_loc(x)])</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Distribution plot'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Above plots are distribution plots on all numerical columns.<br> 1.tenure and MonthlyCharges have a ‘U-shaped’ distribution.<br> 2.TotalCharges has a positive-skew distribution.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2927,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644366827,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="d3c33666-387d-4a3b-b2ff-3996eb789f6d" data-execution_count="236">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#count plot for categorical columns</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> dfcat.columns</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(features)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">5</span>, <span class="bu">len</span>(features)<span class="op">//</span><span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, i)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    sns.countplot(x<span class="op">=</span>df[features[i<span class="op">-</span><span class="dv">1</span>]], color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(features[i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'CountPlot'</span>, size<span class="op">=</span><span class="dv">19</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Here I count plotted all categorical columns.</p>
</section>
<section id="multivariate-analysis" class="level3">
<h3 class="anchored" data-anchor-id="multivariate-analysis">Multivariate Analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2131,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644368955,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a3140ce1-14b9-452a-e701-b518d094bcf2" data-execution_count="237">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#count plots against 'churn'</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> dfcat.columns</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(features)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">5</span>, <span class="bu">len</span>(features)<span class="op">//</span><span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, i)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span>df[features[i<span class="op">-</span><span class="dv">1</span>]], hue<span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    plt.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">8</span>})</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(features[i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'CountPlot vs Churned'</span>, size<span class="op">=</span><span class="dv">19</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>I added Churn count into the categorical plots.<br> 1.You can see for column Gender, the values and Churn count is pretty equal which make this column will have a very low predictive power.<br> 2.For InternetService, fiber optic has way higher in churn probability compare to DSL.<br> 3.Same ways also applied on Month-to-month Contract and Electronic-check PaymentMethod.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:4080,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644373032,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="4fb0d4d8-157a-41e3-814d-368da499e070" data-execution_count="238">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#distribution plots against 'churn'</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>df, </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                 x <span class="op">=</span> dfnum[x],</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'skyblue'</span>, </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                 kde<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                 edgecolor<span class="op">=</span><span class="st">'none'</span>, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>axarr[dfnum.columns.get_loc(x)], </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                 hue<span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Distribution plot"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s also compare Churn distribution on numerical columns. Customers tend to churn when the tenure is low and not churn when the MonthlyCharges is very low. I will do further analysis about these columns later.</p>
<div class="cell" data-execution_count="239">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change binary column into numerical</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>binary <span class="op">=</span> [<span class="st">'gender'</span>,<span class="st">'SeniorCitizen'</span>,<span class="st">'Partner'</span>,<span class="st">'Dependents'</span>,<span class="st">'PhoneService'</span>,<span class="st">'PaperlessBilling'</span>,<span class="st">'Churn'</span>]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>value_mapping <span class="op">=</span> {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No'</span>: <span class="dv">0</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Yes'</span> : <span class="dv">1</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span> : <span class="dv">1</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span> : <span class="dv">0</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>dfcorr <span class="op">=</span> df[binary]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> binary:</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    dfcorr[col] <span class="op">=</span> dfcorr[col].<span class="bu">map</span>(value_mapping).astype(<span class="st">'int64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:7,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644373032,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="5a370df8-4d5b-432b-cc9c-ed8e651a803f" data-execution_count="273">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(dfcorr.corr(), annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Correlation!<br> 1.TotalCharges and tenure have a high positive correlation (causation : the longer the customers subscribed, the more they paid).<br> 2.TotalBenefits also has a strong correlation with MonthlyCharges and TotalCharges (causation : more benefits taken also make the MonthlyCharges higher).<br> Note : Correlation doesn’t indicate causation. Understanding the specific context, industry knowledge, and conducting further analysis or experiments can help determine if there is a causal relationship between the variables or if other factors are influencing the observed correlations.</p>
</section>
</section>
<section id="deep-dive-exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="deep-dive-exploratory-data-analysis">Deep-Dive Exploratory Data Analysis</h2>
<div class="cell" data-execution_count="241">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a function to plot churn probability for numerical columns.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prob_plot(df,colom,x):</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> df[colom].mean()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    medians <span class="op">=</span> df[colom].median()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> df[df.Churn <span class="op">==</span> <span class="st">'Yes'</span>][colom].astype(<span class="st">'float64'</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    data1 <span class="op">=</span> df[df.Churn <span class="op">==</span> <span class="st">'No'</span>][colom].astype(<span class="st">'float64'</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    kde <span class="op">=</span> gaussian_kde(data)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    kde1 <span class="op">=</span> gaussian_kde(data1)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    dist_space <span class="op">=</span> np.linspace( <span class="bu">min</span>(data), <span class="bu">max</span>(data), <span class="dv">200</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    dist_space1 <span class="op">=</span> np.linspace( <span class="bu">min</span>(data1), <span class="bu">max</span>(data1), <span class="dv">200</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    axarr[x].plot( dist_space, kde(dist_space), label<span class="op">=</span><span class="st">'Churned'</span>, color<span class="op">=</span><span class="st">'orange'</span> )</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    axarr[x].plot( dist_space1, kde1(dist_space1), label<span class="op">=</span><span class="st">'Not churn'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    axarr[x].axvline(x <span class="op">=</span> means, linestyle <span class="op">=</span> <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">'Mean'</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    axarr[x].axvline(x <span class="op">=</span> medians, linestyle <span class="op">=</span> <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Median'</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    axarr[x].set_title(<span class="st">'Probability'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    axarr[x].<span class="bu">set</span>(ylabel <span class="op">=</span> <span class="st">'Probability'</span>, xlabel <span class="op">=</span> colom)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    axarr[x].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="services-internetservice-analysis" class="level3">
<h3 class="anchored" data-anchor-id="services-internetservice-analysis">Services &amp; InternetService analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:15,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644459390,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3b5dfc76-98ae-43f3-e95c-024c8834ebb8" data-execution_count="242">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#count plot for Services.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df[df.Services <span class="op">==</span> <span class="st">'Both'</span>], </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'InternetService'</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>              ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>sns.countplot(data<span class="op">=</span>df[df.Services <span class="op">==</span> <span class="st">'Internet Only'</span>], </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>              x<span class="op">=</span><span class="st">'InternetService'</span>, </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>              ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">"Both phone service &amp; internet service"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">"Internet service only"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Comparison of internet services on product services"</span>)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It is observed that customers tend to prefer Fiber optic over DSL for ‘phone &amp; internet service’. However, when considering ‘internet service only’ without phone, there is no option for Fiber optic available. This suggests that in order to utilize Fiber optic, a phone connection (or phone service) is required.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1333,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460709,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="c146769d-3b88-4454-bf06-7a0494efd1d7" data-execution_count="243">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot churn probability for 'services' &amp; 'internet services'</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Services'</span>)[<span class="st">'Churn'</span>].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(<span class="bu">list</span>(x)))<span class="op">\</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                               .plot(kind<span class="op">=</span><span class="st">'bar'</span>, width<span class="op">=</span><span class="fl">0.3</span>,rot<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>df[df.Services <span class="op">!=</span> <span class="st">'Phone Only'</span>].groupby([<span class="st">'InternetService'</span>])[<span class="st">'Churn'</span>].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x))<span class="op">\</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                               .plot(kind<span class="op">=</span><span class="st">'bar'</span>, width<span class="op">=</span><span class="fl">0.3</span>,rot<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'Services churn probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Internet service churn probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Customers that used ‘Both’ services and InternetService fiber optic tends to churn more.</p>
</section>
<section id="monthlycharges-analysis" class="level3">
<h3 class="anchored" data-anchor-id="monthlycharges-analysis">MonthlyCharges analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:26,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8117c6d1-344a-4989-ad74-87f75d24247d" data-execution_count="244">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#checking InternetService price.</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df[(df.Services <span class="op">==</span> <span class="st">'Both'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>)].copy()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df_filtered.groupby(<span class="st">'InternetService'</span>)[<span class="st">'MonthlyCharges'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="244">
<pre><code>InternetService
DSL            44.965089
Fiber optic    70.074454
Name: MonthlyCharges, dtype: float64</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The price of Fiber optic is higher, around 25 USD, compared to DSL. However, it’s important to keep in mind that these prices include a phone service with a single line.</p>
</blockquote>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:25,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="80e9644f-1a90-4177-e68b-4374a785d47d" data-execution_count="245">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df[(df.Services <span class="op">==</span> <span class="st">'Phone Only'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">0</span>)].copy()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df_filtered.groupby(<span class="st">'MultipleLines'</span>)[<span class="st">'MonthlyCharges'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="245">
<pre><code>MultipleLines
No     19.958088
Yes    24.980060
Name: MonthlyCharges, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="2499b9e2-4388-49bf-ee6c-af13edec5c38" data-execution_count="246">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>df_filtered, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">'MonthlyCharges'</span>, </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>             hue<span class="op">=</span><span class="st">'MultipleLines'</span>, </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>             multiple<span class="op">=</span><span class="st">'stack'</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Phone service distribution'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can see that the price for a ‘phone service’ with a single line is around 20 USD, while the price for a ‘phone service’ with multiple lines is around 25 USD. This also means that the price for DSL is around 25 USD, while the price for Fiber optic is around 50 USD, which is twice as much as DSL.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460711,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="ce28b72e-2787-4f0e-925c-c76d3f9983d2" data-execution_count="247">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mc_dist <span class="op">=</span> sns.histplot(data<span class="op">=</span>df, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                       x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                       hue<span class="op">=</span><span class="st">'Churn'</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                       ax<span class="op">=</span>axarr[<span class="dv">0</span>], </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                       multiple<span class="op">=</span><span class="st">'stack'</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>prob_plot(df,<span class="st">'MonthlyCharges'</span>,<span class="dv">1</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>At a MonthlyCharges range of approximately +- 20 USD, the ratio of non-churn customers is very high. It is known that products within this price range are typically ‘phone service only’. However, between the price range of 60 - 100 USD, the churn probability increases significantly. I am planning to conduct further analysis specifically for customers within this price range.</p>
<div class="cell" data-execution_count="248">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df[(df.InternetService <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (df.Services <span class="op">==</span> <span class="st">'Both'</span>) <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>)]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_agg <span class="op">=</span> df_filtered.groupby(<span class="st">'TotalBenefits'</span>)[<span class="st">'MonthlyCharges'</span>].agg(<span class="st">'mean'</span>).reset_index()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>df_agg[<span class="st">'MonthlyCharges'</span>] <span class="op">=</span> df_agg.MonthlyCharges.<span class="bu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:22,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460711,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="e99960cb-8117-4037-e1fa-e548ef109dc3" data-execution_count="249">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df_filtered, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span><span class="st">'MonthlyCharges'</span>, </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span><span class="st">'TotalBenefits'</span>, </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                s<span class="op">=</span><span class="dv">35</span>, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>sns.barplot(df_agg, x <span class="op">=</span> <span class="st">'TotalBenefits'</span>, y <span class="op">=</span> <span class="st">'MonthlyCharges'</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'MonthlyCharges vs Totalbenefits'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Average MonthlyCharges vs Totalbenefits'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Here, you can observe that as more TotalBenefits are taken, the MonthlyCharges also increase. On the left plot, you can see that there are 5 outlier data points, which will be removed later.</p>
<div class="cell" data-execution_count="250">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_fil <span class="op">=</span> df[(df.InternetService <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (df.Services <span class="op">==</span> <span class="st">'Both'</span>)<span class="op">\</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>              <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">1</span>)]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>benefits <span class="op">=</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>df_benefit <span class="op">=</span> pd.DataFrame()</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> benefits:</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    df_value <span class="op">=</span> pd.DataFrame([x, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                      df_fil[df_fil[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].<span class="bu">min</span>(), </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                      df_fil[df_fil[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].<span class="bu">max</span>(), </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                      df_fil[df_fil[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].mean(), </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                      df_fil[df_fil[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].median()</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>                     ]).transpose()</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    df_benefit <span class="op">=</span> pd.concat([df_benefit, df_value])</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>df_benefit.columns <span class="op">=</span> [<span class="st">'Benefit'</span>,<span class="st">'MinCharges'</span>,<span class="st">'MaxCharges'</span>,<span class="st">'MeanCharges'</span>,<span class="st">'MedianCharges'</span>]    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="251">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df_benefit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="251">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Benefit</th>
<th data-quarto-table-cell-role="th">MinCharges</th>
<th data-quarto-table-cell-role="th">MaxCharges</th>
<th data-quarto-table-cell-role="th">MeanCharges</th>
<th data-quarto-table-cell-role="th">MedianCharges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>OnlineSecurity</td>
<td>73.2</td>
<td>76.45</td>
<td>74.795588</td>
<td>74.95</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>OnlineBackup</td>
<td>72.75</td>
<td>76.65</td>
<td>74.708511</td>
<td>74.65</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DeviceProtection</td>
<td>69.55</td>
<td>76.65</td>
<td>74.604762</td>
<td>74.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>TechSupport</td>
<td>73.85</td>
<td>76.55</td>
<td>75.045455</td>
<td>74.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>StreamingTV</td>
<td>77.65</td>
<td>81.9</td>
<td>79.749242</td>
<td>79.825</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>StreamingMovies</td>
<td>12.0</td>
<td>86.1</td>
<td>79.045902</td>
<td>80.15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Above are the prices of benefits with Fiber optic and a single line phone connection. You can see that StreamingTV and StreamingMovies are more expensive compared to other benefits, approximately +- 5 USD.</p>
<p>Now that we know the prices of every product, here’s a recap:<br></p>
<p>DSL = approximately 25 USD.<br> Fiber optic = approximately 50 USD.<br> Phone service (single line) = approximately 20 USD.<br> Phone service (multiple lines) = approximately 25 USD.<br> OnlineSecurity - TechSupport = approximately 5 USD.<br> StreamingTV - StreamingMovies = approximately 10 USD.<br></p>
<p>With this data, we can perform a simple ‘anomaly detection’ by manually calculating the MonthlyCharges and comparing them with the actual MonthlyCharges, similar to how we calculated the TotalChargesDiff above.</p>
<div class="cell" data-execution_count="252">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#checking for MonthlyCharges values with the calculated one (similar with checking TotalCharges difference).</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> MonthlyChargesDiff(x):</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    estimation <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'PhoneService'</span>] <span class="op">==</span> <span class="st">'Yes'</span>:</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">20</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'MultipleLines'</span>] <span class="op">==</span> <span class="st">'Yes'</span>:</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'DSL'</span>:</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">25</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'Fiber optic'</span>:</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">50</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[<span class="st">'StreamingTV'</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="st">'StreamingMovies'</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">20</span> <span class="op">+</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">-</span> <span class="dv">2</span>) <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="st">'StreamingTV'</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">|</span> (x[<span class="st">'StreamingMovies'</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">10</span> <span class="op">+</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> x[<span class="st">'TotalBenefits'</span>] <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(<span class="dv">1</span> <span class="op">-</span> (estimation <span class="op">/</span> x[<span class="st">'MonthlyCharges'</span>])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="253">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MonthlyChargesEstimationDifference'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(MonthlyChargesDiff, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="254">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df[df.MonthlyChargesEstimationDifference <span class="op">&gt;</span> <span class="dv">40</span>][[<span class="st">'MonthlyCharges'</span>,<span class="st">'MonthlyChargesEstimationDifference'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="254">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">MonthlyChargesEstimationDifference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>29.00</td>
<td>296.551724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">389</td>
<td>12.00</td>
<td>733.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">666</td>
<td>12.00</td>
<td>566.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">859</td>
<td>26.41</td>
<td>278.644453</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1439</td>
<td>18.26</td>
<td>447.645126</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2185</td>
<td>21.63</td>
<td>362.320851</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4090</td>
<td>31.26</td>
<td>219.897633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5848</td>
<td>15.00</td>
<td>466.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6718</td>
<td>21.00</td>
<td>304.761905</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You can see that there are 9 rows with extreme MonthlyCharges values. These are considered as ‘anomalies’, so let’s remove them.</p>
<div class="cell" data-execution_count="255">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove MonthlyCharges extreme values.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.MonthlyChargesEstimationDifference <span class="op">&lt;</span> <span class="dv">40</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="customer-analysis" class="level3">
<h3 class="anchored" data-anchor-id="customer-analysis">Customer analysis</h3>
<div class="cell" data-execution_count="256">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#creating a function to engineered a new feature.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> statuss(x):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">list</span>(x)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Both'</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'No'</span>):</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Partner Only'</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'No'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Dependent Only'</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Single'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="257">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Status'</span>] <span class="op">=</span> df[[<span class="st">'Partner'</span>,<span class="st">'Dependents'</span>]].<span class="bu">apply</span>(statuss, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I have created a new feature called ‘Status’. This feature is derived from the columns Partner and Dependents.<br> 1.If customers have both Partner and Dependents, it will be labeled as ‘Both’.<br> 2.If customers have Partner but no Dependents, it will be labeled as ‘Partner Only’.<br> 3.If customers have Dependents but no Partner, it will be labeled as ‘Dependent Only’.<br> 4.If customers have neither Partner nor Dependents, it will be labeled as ‘Single’.<br></p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460712,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="92ac2c61-a43c-49e7-a10d-bf2619ae13d4" data-execution_count="258">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(df.sort_values(<span class="st">'Status'</span>, ascending<span class="op">=</span><span class="va">True</span>), x<span class="op">=</span><span class="st">'Status'</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Status Count'</span>, size<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-50-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Majority of customers are Single.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460712,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="bb780263-68a3-4cf7-bb4c-7cb0caf75bfb" data-execution_count="259">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> [<span class="st">'tenure'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalBenefits'</span>]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> k:</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    sns.barplot(data<span class="op">=</span>df.groupby([<span class="st">'Status'</span>])[[x]].mean().reset_index(), </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span><span class="st">'Status'</span>, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                y<span class="op">=</span>x, </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                ax<span class="op">=</span>axarr[k.index(x)],</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>                palette<span class="op">=</span>[<span class="st">'grey'</span>, <span class="st">'g'</span>,<span class="st">'m'</span>,<span class="st">'b'</span>])</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    axarr[k.index(x)].set_title(<span class="ss">f'</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> average'</span>, weight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-51-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Customers labeled as ‘Partner Only’ are considered the best since they have the longest tenure and the highest MonthlyCharges. The second-best group is ‘Both’, although these customers may not have MonthlyCharges as high as those in the ‘Single’ group, their tenure is almost double that of the ‘Single’ group.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460713,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="e59c631a-c7db-401b-b61b-4cb64e9cae6d" data-execution_count="260">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>df.groupby(<span class="st">'Status'</span>)[[<span class="st">'Churn'</span>]].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">/</span> <span class="bu">len</span>(x)).reset_index(), </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">'Status'</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Churn Probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Single customers have the highest churn probability.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460713,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="88e0aacd-d3b0-4bf5-c098-6188aa3680c6" data-execution_count="261">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df.SeniorCitizen.value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="261">
<pre><code>SeniorCitizen
No     0.837903
Yes    0.162097
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<p>The majority of customers are young people.</p>
<div class="cell" data-execution_count="262">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_status <span class="op">=</span> df.groupby(<span class="st">'SeniorCitizen'</span>)[[<span class="st">'Status'</span>]]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>df_status <span class="op">=</span> df_status.agg(Single <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Single'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x)), </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                          PartnerOnly <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Partner Only'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)), </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                          Both <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Both'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)), </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                          DependentOnly <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Dependent Only'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>df_status <span class="op">=</span> df_status.reset_index().melt(id_vars<span class="op">=</span><span class="st">'SeniorCitizen'</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>df_status <span class="op">=</span> df_status.rename(columns<span class="op">=</span>{<span class="st">'variable'</span>:<span class="st">'Status'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460714,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a518d565-5aa8-44dc-bc45-539538aae93c" data-execution_count="263">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">5</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(data<span class="op">=</span>df_status, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span><span class="st">'SeniorCitizen'</span>, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'value'</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>            hue<span class="op">=</span><span class="st">'Status'</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Status comparison between senior citizen"</span>, size<span class="op">=</span><span class="dv">15</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>For non-Senior citizens, ‘Single’ customers have the highest frequency, followed by ‘Both’. For Senior citizens, ‘Single’ is also the highest category, but the difference with ‘PartnerOnly’ is not as significant. From the plots above, we can also conclude that young people tend to have dependents more than older people.</p>
<div class="cell" data-execution_count="264">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_status <span class="op">=</span> df.groupby(<span class="st">'Status'</span>)[[<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]]<span class="op">\</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                                  .agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>df_status[<span class="st">'total'</span>] <span class="op">=</span> df_status.<span class="bu">apply</span>(<span class="st">'sum'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df_status.drop(columns<span class="op">=</span><span class="st">'total'</span>).columns:</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    df_status[x] <span class="op">=</span> (df_status[x] <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> df_status.total).<span class="bu">round</span>()</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>df_status.drop(columns<span class="op">=</span><span class="st">'total'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460715,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="0213aa2b-d477-4d53-9800-82148d57f615" data-execution_count="265">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_status.plot(kind<span class="op">=</span><span class="st">'bar'</span>, rot<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Benefit count comparison between status (%)'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Single and PartnerOnly customers tend to prefer entertainment benefits such as StreamingTV and StreamingMovies compared to other customers. Additionally, these customers show a lower preference for using TechSupport and OnlineSecurity.</p>
</section>
<section id="benefits-analysis" class="level3">
<h3 class="anchored" data-anchor-id="benefits-analysis">Benefits analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:1450,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644462145,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8c9a5f17-99b8-49f1-d489-a584a40403da" data-execution_count="266">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(df[df.Services <span class="op">!=</span> <span class="st">'Phone Only'</span>], </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="st">'TotalBenefits'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>sns.barplot(df[[<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]]<span class="op">\</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            .<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>)).reset_index(), x <span class="op">=</span> <span class="st">'index'</span>, y <span class="op">=</span> <span class="dv">0</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'TotalBenefits Count'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Benefits Count'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The average number of TotalBenefits taken by customers is around 3, with StreamingTV and StreamingMovies being the most popular choices.</p>
<div class="cell" data-execution_count="267">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_total <span class="op">=</span> pd.DataFrame()</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]:</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="bu">list</span>(df[df[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'Churn'</span>]).count(<span class="st">'Yes'</span>) <span class="op">/</span> <span class="bu">len</span>(df[df[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'Churn'</span>])</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    df_total <span class="op">=</span> pd.concat([df_total, pd.DataFrame([x],[total])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:5,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644462146,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="ca567756-56c7-422b-bc62-5957e94729b4" data-execution_count="268">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(df.groupby(<span class="st">'TotalBenefits'</span>)[[<span class="st">'Churn'</span>]]<span class="op">\</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>            .agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x)).<span class="bu">round</span>().reset_index(), </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="st">'TotalBenefits'</span>, </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'Churn'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>sns.barplot(df_total.reset_index(), </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span><span class="st">'index'</span>, </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>            ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'TotalBenefits Churn probability'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>, xlabel<span class="op">=</span><span class="st">'Benefits'</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Benefits Churn probability'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>While StreamingTV and StreamingMovies are the most favored choices, the churn probability associated with them is also the highest.</p>
</section>
<section id="churn-analysis" class="level3">
<h3 class="anchored" data-anchor-id="churn-analysis">Churn analysis</h3>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2475,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644464617,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="1c9642d7-a37f-4cfc-abc1-37fd31be306f" data-execution_count="269">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df, </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>, </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                y <span class="op">=</span> <span class="st">'tenure'</span>, </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                hue <span class="op">=</span><span class="st">'Churn'</span>, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                s<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="fl">52.5</span>, <span class="fl">72.5</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MonthlyCharges vs tenure vs Churn'</span>, size <span class="op">=</span> <span class="dv">15</span>, weight <span class="op">=</span> <span class="st">'bold'</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Here, I have created two areas, denoted by green and blue, both focusing on MonthlyCharges in the range of 70 - 95 USD. This price range corresponds to the highest churn probability. The green area represents customers with low tenure and is predominantly occupied by churned customers, while the blue area represents customers with high tenure and is predominantly occupied by non-churned customers.</p>
<div class="cell" data-executioninfo="{&quot;elapsed&quot;:2365,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644466969,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="041fbef0-cc28-482a-d89f-e464a718002c" data-execution_count="270">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df, </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                y <span class="op">=</span> <span class="st">'tenure'</span>, </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                s<span class="op">=</span><span class="dv">35</span>, </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                hue<span class="op">=</span><span class="st">'TotalBenefits'</span>, </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                style<span class="op">=</span><span class="st">'InternetService'</span>, </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                palette<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="fl">52.5</span>, <span class="fl">72.5</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MonthlyCharges vs tenure vs TotalBenefits vs InternetService'</span>, size <span class="op">=</span> <span class="dv">15</span>, weight <span class="op">=</span> <span class="st">'bold'</span>)</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Still on the same plot, I have added TotalBenefits and InternetService. It can be observed that in the green area, Fiber optic is the dominant InternetService with low TotalBenefits. On the other hand, the blue area is dominated by DSL with high TotalBenefits. This indicates that customers, at the same price point, tend to choose DSL with high TotalBenefits rather than Fiber optic with low TotalBenefits. Note that Fiber optic prices are doubled than DSL.</p>
<p>With the observed pattern above, we can create an important new feature, which we will refer to as ‘FO_LB’ (Fiber optic_Low benefit). I will assign a value of ‘1’ to indicate that the internet service is Fiber optic and the Totalbenefits taken are less than or equal to 3. For other cases, I will assign ‘0’.</p>
<div class="cell" data-execution_count="64">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'FO_LB'</span>] <span class="op">=</span> df[[<span class="st">'InternetService'</span>,<span class="st">'TotalBenefits'</span>]].<span class="bu">apply</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> (x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">&lt;=</span> <span class="dv">3</span>) <span class="cf">else</span> <span class="dv">0</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="modelling" class="level2">
<h2 class="anchored" data-anchor-id="modelling">Modelling</h2>
<p>One important thing to address before we proceed is considering the types of errors to make this project as realistic as possible. Typically, there are two types of errors: false positive (FP) and false negative (FN). However, in this project, I will introduce three types of errors.<br></p>
<p>1.FP: False positive <br> 2.FN1: False negative for customers with MonthlyCharges below 95 USD <br> 3.FN2: False negative for customers with MonthlyCharges above 95 USD (VIP customers) <br> Let’s agree on the misclassification ratio, which is FP:FN1:FN2 = 1:3:5 <br></p>
<p>It’s important to note that this dataset is imbalanced, meaning there is a significant difference in the number of samples between the classes.</p>
<p>Based on these problems, we can set up our model’s parameters as follows:<br><br> 1.Hyperparameter tuning.<br> 2.Decision threshold tuning.<br> 3.Oversampling data using SMOTE.<br> 4.Applying weights to the models.<br> I will be using Random Forest, XGBoost, and Logistic Regression.</p>
<p>Metrics:<br> Custom scoring based on sample misclassification.<br> Precision.<br> Recall.<br> F1_score.<br> Once the models are evaluated using these metrics, I will interpret the best model.</p>
<section id="feature-selection-encoding" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection-encoding">Feature selection &amp; encoding</h3>
<div class="cell" data-execution_count="65">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="66">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df1.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="67">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop columns</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns <span class="op">=</span> [<span class="st">'Services'</span>,<span class="st">'MonthlyChargesEstimationDifference'</span>,<span class="st">'Status'</span>,<span class="st">'PaperlessBilling'</span>,<span class="st">'PaymentMethod'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I have dropped the columns from ‘Services’ to ‘Status’ as these columns were engineered features created for simpler exploratory data analysis (EDA). Additionally, I have also dropped the ‘PaperlessBilling’ and ‘PaymentMethod’ columns because, in the business context, these columns are considered irrelevant for determining customer churn since they represent optional ‘features’ for customers.</p>
<div class="cell" data-execution_count="68">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#converting 'No internet service' to 'No' in benefit columns.</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>KolomBenefit <span class="op">=</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> KolomBenefit:</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    df[x] <span class="op">=</span> df[x].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'No internet service'</span> <span class="cf">else</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="69">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#converting 'No phone service' to 'No'</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MultipleLines'</span>] <span class="op">=</span> df[x].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'No phone service'</span> <span class="cf">else</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="70">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dict to mapping string to numerical.</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>value_mapping <span class="op">=</span> {</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No'</span>: <span class="dv">0</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Yes'</span> : <span class="dv">1</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span> : <span class="dv">1</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span> : <span class="dv">0</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-scrolled="true" data-execution_count="71">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#binary encoding</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>binary <span class="op">=</span> <span class="bu">list</span>(df.drop(columns<span class="op">=</span>[<span class="st">'tenure'</span>,<span class="st">'InternetService'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalCharges'</span>,<span class="st">'TotalBenefits'</span>,<span class="st">'Contract'</span>,<span class="st">'FO_LB'</span>]).columns)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> binary:</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].<span class="bu">map</span>(value_mapping).astype(<span class="st">'int64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="72">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#label encoding</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Contract'</span>] <span class="op">=</span> df[<span class="st">'Contract'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'Month-to-month'</span> <span class="cf">else</span> <span class="dv">2</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'One year'</span> <span class="cf">else</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="73">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#one hot encoding</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df, columns<span class="op">=</span>[<span class="st">'InternetService'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="74">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#feature selection</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">'Contract'</span>,<span class="st">'tenure'</span>,<span class="st">'InternetService_Fiber optic'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'FO_LB'</span>,<span class="st">'InternetService_No'</span>,<span class="st">'Churn'</span>]]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns<span class="op">=</span>{</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'InternetService_Fiber optic'</span>:<span class="st">'Fiber_optic'</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'InternetService_No'</span>:<span class="st">'No_internet'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here I only choose a feature that have a strong predictive power (by using feature of importances)</p>
</section>
<section id="splits-data-and-define-custom-function" class="level3">
<h3 class="anchored" data-anchor-id="splits-data-and-define-custom-function">Splits data and define custom function</h3>
<div class="cell" data-execution_count="75">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#split train-test</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(df.drop(columns<span class="op">=</span><span class="st">'Churn'</span>), df.Churn.to_numpy(), test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="76">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#custom function to do threshold tuning and custom metrics (used in GridSearchCV)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_2(clf, X, y_true, thres <span class="op">=</span> np.arange(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)):</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    result_dict <span class="op">=</span> {}</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> threshold <span class="kw">in</span> np.atleast_1d(thres):</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> (clf.predict_proba(X)[:,<span class="dv">1</span>] <span class="op">&gt;</span> threshold).astype(<span class="bu">int</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        X_segment <span class="op">=</span> (X[<span class="st">'MonthlyCharges'</span>] <span class="op">&gt;</span> <span class="dv">95</span>).to_numpy().astype(<span class="bu">int</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        y_stack <span class="op">=</span> np.column_stack((X_segment, y_pred, y_true))</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>        y_stack_reg, y_stack_vip <span class="op">=</span> y_stack[y_stack[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>], y_stack[y_stack[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        cm_reg <span class="op">=</span> confusion_matrix(y_stack_reg[:,<span class="dv">2</span>], y_stack_reg[:,<span class="dv">1</span>])</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        cm_vip <span class="op">=</span> confusion_matrix(y_stack_vip[:,<span class="dv">2</span>], y_stack_vip[:,<span class="dv">1</span>])</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        fn_reg, fn_vip <span class="op">=</span> cm_reg[<span class="dv">1</span>][<span class="dv">0</span>], cm_vip[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> cm_reg[<span class="dv">0</span>][<span class="dv">1</span>] <span class="op">+</span> cm_vip[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>        loss_score <span class="op">=</span> (fp <span class="op">*</span> <span class="dv">1</span>) <span class="op">+</span> (fn_reg <span class="op">*</span> <span class="dv">3</span>) <span class="op">+</span> (fn_vip <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>        result_dict[threshold] <span class="op">=</span> np.array([loss_score, metrics.precision_score(y_true, y_pred, zero_division <span class="op">=</span> <span class="dv">0</span>), </span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>                                           metrics.recall_score(y_true, y_pred), metrics.f1_score(y_true, y_pred)])</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>    result_np <span class="op">=</span> np.array([np.insert(value, <span class="dv">0</span>, key) <span class="cf">for</span> key, value <span class="kw">in</span> result_dict.items()])</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>    best_np <span class="op">=</span> result_np[result_np[:,<span class="dv">1</span>] <span class="op">==</span> np.<span class="bu">min</span>(result_np[:,<span class="dv">1</span>])][<span class="dv">0</span>]</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_np</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_threshold(clf, X, y_true):</span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">0</span>]</span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_ls(clf, X, y_true):</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">1</span>]</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_precision(clf, X, y_true):</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">2</span>]</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_recall(clf, X, y_true):</span>
<span id="cb83-31"><a href="#cb83-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">3</span>]</span>
<span id="cb83-32"><a href="#cb83-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-33"><a href="#cb83-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_f1(clf, X, y_true):</span>
<span id="cb83-34"><a href="#cb83-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">4</span>]</span>
<span id="cb83-35"><a href="#cb83-35" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-36"><a href="#cb83-36" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="77">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grid scoring parameter</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>grid_scoring <span class="op">=</span> {</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'threshold'</span>: my_scorer_threshold,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'loss_score'</span>: my_scorer_ls,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precision'</span>: my_scorer_precision,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'recall'</span>: my_scorer_recall,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'f1'</span>: my_scorer_f1</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="78">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define weight by missclassification cost which is FP:FN1:FN2 = 1:3:5</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>X_segment <span class="op">=</span> (X_train[<span class="st">'MonthlyCharges'</span>] <span class="op">&gt;</span> <span class="dv">95</span>).to_numpy().astype(<span class="bu">int</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>arr_weight <span class="op">=</span> np.column_stack((X_segment, y_train))</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> np.apply_along_axis(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">5</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">3</span> , axis<span class="op">=</span><span class="dv">1</span>, arr<span class="op">=</span>arr_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-building-1-hyperparameter-tuning-threshold-tuning" class="level3">
<h3 class="anchored" data-anchor-id="model-building-1-hyperparameter-tuning-threshold-tuning">Model building 1 / Hyperparameter tuning + threshold tuning</h3>
<div class="cell" data-scrolled="true" data-execution_count="79">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf <span class="op">=</span> {</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> RandomForestClassifier(),</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train, y_train)</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>mb1_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>mb1_rf <span class="op">=</span> np.append(mb1_rf, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="80">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg <span class="op">=</span> {</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> XGBClassifier(),</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train)</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train, y_train)</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>mb1_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>mb1_xg <span class="op">=</span> np.append(mb1_xg, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="81">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg <span class="op">=</span> {</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> LogisticRegression(),</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg,</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train)</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train, y_train)</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>mb1_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>mb1_lg <span class="op">=</span> np.append(mb1_lg, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="82">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>result_mb1 <span class="op">=</span> pd.DataFrame([mb1_rf,mb1_xg,mb1_lg])</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>result_mb1.columns <span class="op">=</span> [<span class="st">'threshold'</span>,<span class="st">'score'</span>,<span class="st">'precision'</span>,<span class="st">'recall'</span>,<span class="st">'f1'</span>,<span class="st">'params'</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>result_mb1[<span class="st">'model'</span>] <span class="op">=</span> [<span class="st">'MB1_RF'</span>,<span class="st">'MB1_XG'</span>,<span class="st">'MB1_Log_Reg'</span>]</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>result_mb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">threshold</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">precision</th>
<th data-quarto-table-cell-role="th">recall</th>
<th data-quarto-table-cell-role="th">f1</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.24</td>
<td>539.0</td>
<td>0.473101</td>
<td>0.828255</td>
<td>0.602216</td>
<td>{'bootstrap': True, 'max_depth': 25, 'min_samp...</td>
<td>MB1_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.20</td>
<td>558.0</td>
<td>0.449190</td>
<td>0.844875</td>
<td>0.586538</td>
<td>{'colsample_bytree': 0.8, 'learning_rate': 0.0...</td>
<td>MB1_XG</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.22</td>
<td>541.0</td>
<td>0.467492</td>
<td>0.836565</td>
<td>0.599801</td>
<td>{'C': 0.1, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB1_Log_Reg</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="model-building-2-hyperparameter-tuning-threshold-tuning-smote" class="level3">
<h3 class="anchored" data-anchor-id="model-building-2-hyperparameter-tuning-threshold-tuning-smote">Model building 2 / Hyperparameter tuning + threshold tuning + SMOTE</h3>
<div class="cell" data-execution_count="83">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf_smote <span class="op">=</span> {</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>pipelinerf <span class="op">=</span> Pipeline([</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, RandomForestClassifier())])</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinerf,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf_smote,</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>params)</span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train1, y_train1)</span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a>mb2_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a>mb2_rf <span class="op">=</span> np.append(mb2_rf, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="84">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg_smote <span class="op">=</span> {</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>pipelinexg <span class="op">=</span> Pipeline([</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, XGBClassifier())])</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinexg,</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg_smote,</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train)</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>params)</span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb91-41"><a href="#cb91-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb91-42"><a href="#cb91-42" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train1, y_train1)</span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>mb2_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>mb2_xg <span class="op">=</span> np.append(mb2_xg, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="85">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg_smote <span class="op">=</span> {</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>pipelinelg <span class="op">=</span> Pipeline([</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, LogisticRegression())])</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinelg,</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg_smote,</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>params)</span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train1, y_train1)</span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a>mb2_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a>mb2_lg <span class="op">=</span> np.append(mb2_lg, params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="86">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>result_mb2 <span class="op">=</span> pd.DataFrame([mb2_rf,mb2_xg,mb2_lg])</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>result_mb2.columns <span class="op">=</span> [<span class="st">'threshold'</span>,<span class="st">'score'</span>,<span class="st">'precision'</span>,<span class="st">'recall'</span>,<span class="st">'f1'</span>,<span class="st">'params'</span>]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>result_mb2[<span class="st">'model'</span>] <span class="op">=</span> [<span class="st">'MB2_RF'</span>,<span class="st">'MB2_XG'</span>,<span class="st">'MB2_Log_Reg'</span>]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>result_mb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">threshold</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">precision</th>
<th data-quarto-table-cell-role="th">recall</th>
<th data-quarto-table-cell-role="th">f1</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.42</td>
<td>557.0</td>
<td>0.454955</td>
<td>0.839335</td>
<td>0.590068</td>
<td>{'bootstrap': False, 'max_depth': 25, 'min_sam...</td>
<td>MB2_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.44</td>
<td>546.0</td>
<td>0.472266</td>
<td>0.825485</td>
<td>0.600806</td>
<td>{'colsample_bytree': 1.0, 'learning_rate': 0.0...</td>
<td>MB2_XG</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.48</td>
<td>546.0</td>
<td>0.472178</td>
<td>0.822715</td>
<td>0.600000</td>
<td>{'C': 1.0, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB2_Log_Reg</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>You see that the threshold on all models are increasing than model building 1 because SMOTE make the models learn more on the positive class.</p>
</section>
<section id="model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight" class="level3">
<h3 class="anchored" data-anchor-id="model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight">Model building 3 / Hyperparameter tuning + threshold tuning + custom weight</h3>
<div class="cell" data-execution_count="87">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf <span class="op">=</span> {</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> RandomForestClassifier(),</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf,</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>mb3_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>mb3_rf <span class="op">=</span> np.append(mb3_rf, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="88">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg <span class="op">=</span> {</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> XGBClassifier(),</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>mb3_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>mb3_xg <span class="op">=</span> np.append(mb3_xg, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="89">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg <span class="op">=</span> {</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> LogisticRegression(),</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>mb3_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>mb3_lg <span class="op">=</span> np.append(mb3_lg, grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="90">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>result_mb3 <span class="op">=</span> pd.DataFrame([mb3_rf,mb3_xg,mb3_lg])</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>result_mb3.columns <span class="op">=</span> [<span class="st">'threshold'</span>,<span class="st">'score'</span>,<span class="st">'precision'</span>,<span class="st">'recall'</span>,<span class="st">'f1'</span>,<span class="st">'params'</span>]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>result_mb3[<span class="st">'model'</span>] <span class="op">=</span> [<span class="st">'MB3_RF'</span>,<span class="st">'MB3_XG'</span>,<span class="st">'MB3_Log_Reg'</span>]</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>result_mb3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="90">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">threshold</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">precision</th>
<th data-quarto-table-cell-role="th">recall</th>
<th data-quarto-table-cell-role="th">f1</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.48</td>
<td>549.0</td>
<td>0.456193</td>
<td>0.836565</td>
<td>0.590420</td>
<td>{'bootstrap': True, 'max_depth': 25, 'min_samp...</td>
<td>MB3_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.48</td>
<td>551.0</td>
<td>0.465409</td>
<td>0.819945</td>
<td>0.593781</td>
<td>{'colsample_bytree': 0.8, 'learning_rate': 0.0...</td>
<td>MB3_XG</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.44</td>
<td>571.0</td>
<td>0.433803</td>
<td>0.853186</td>
<td>0.575163</td>
<td>{'C': 0.1, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB3_Log_Reg</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="91">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>final_result <span class="op">=</span> pd.concat([result_mb1, result_mb2, result_mb3]).sort_values(<span class="st">'score'</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>final_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="91">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">threshold</th>
<th data-quarto-table-cell-role="th">score</th>
<th data-quarto-table-cell-role="th">precision</th>
<th data-quarto-table-cell-role="th">recall</th>
<th data-quarto-table-cell-role="th">f1</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.24</td>
<td>539.0</td>
<td>0.473101</td>
<td>0.828255</td>
<td>0.602216</td>
<td>{'bootstrap': True, 'max_depth': 25, 'min_samp...</td>
<td>MB1_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.22</td>
<td>541.0</td>
<td>0.467492</td>
<td>0.836565</td>
<td>0.599801</td>
<td>{'C': 0.1, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB1_Log_Reg</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.44</td>
<td>546.0</td>
<td>0.472266</td>
<td>0.825485</td>
<td>0.600806</td>
<td>{'colsample_bytree': 1.0, 'learning_rate': 0.0...</td>
<td>MB2_XG</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.48</td>
<td>546.0</td>
<td>0.472178</td>
<td>0.822715</td>
<td>0.600000</td>
<td>{'C': 1.0, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB2_Log_Reg</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.48</td>
<td>549.0</td>
<td>0.456193</td>
<td>0.836565</td>
<td>0.590420</td>
<td>{'bootstrap': True, 'max_depth': 25, 'min_samp...</td>
<td>MB3_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.48</td>
<td>551.0</td>
<td>0.465409</td>
<td>0.819945</td>
<td>0.593781</td>
<td>{'colsample_bytree': 0.8, 'learning_rate': 0.0...</td>
<td>MB3_XG</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.42</td>
<td>557.0</td>
<td>0.454955</td>
<td>0.839335</td>
<td>0.590068</td>
<td>{'bootstrap': False, 'max_depth': 25, 'min_sam...</td>
<td>MB2_RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.20</td>
<td>558.0</td>
<td>0.449190</td>
<td>0.844875</td>
<td>0.586538</td>
<td>{'colsample_bytree': 0.8, 'learning_rate': 0.0...</td>
<td>MB1_XG</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.44</td>
<td>571.0</td>
<td>0.433803</td>
<td>0.853186</td>
<td>0.575163</td>
<td>{'C': 0.1, 'max_iter': 50, 'penalty': 'l2', 's...</td>
<td>MB3_Log_Reg</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Analysis of how the models performed:<br> 1.RandomForest performs best with hyperparameter tuning and a lower decision threshold. However, this model performs worst when using SMOTE.<br> 2.LogisticRegression performs worst when using ‘sample weighting’.<br> 3.XGBoost performs best when using SMOTE.<br> 4.It’s important to note that all models produce similar results when using their best parameters and conditions.<br> 5.In my opinion, the greatest impact is achieved by using hyperparameter tuning and decision threshold tuning, rather than using SMOTE and weighting techniques.</p>
</section>
</section>
<section id="model-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="model-interpretation">Model Interpretation</h2>
<p>In this section, I want to show you how to interpret a tree-based model, such as Random Forest, so we can have a better understanding of how the model actually works.</p>
<div class="cell" data-execution_count="92">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter for random forest</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>rf_param <span class="op">=</span> final_result[final_result[<span class="st">'model'</span>] <span class="op">==</span> <span class="st">'MB1_RF'</span>][<span class="st">'params'</span>][<span class="dv">0</span>]</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>rf_param</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>{'bootstrap': True,
 'max_depth': 25,
 'min_samples_leaf': 50,
 'min_samples_split': 50,
 'n_estimators': 250}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>rf_param)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="93">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=25, min_samples_leaf=50, min_samples_split=50,
                       n_estimators=250)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(max_depth=25, min_samples_leaf=50, min_samples_split=50,
                       n_estimators=250)</pre></div></div></div></div></div>
</div>
</div>
<section id="partial-dependence-plot-pdp-individual-conditional-expectation-ice" class="level3">
<h3 class="anchored" data-anchor-id="partial-dependence-plot-pdp-individual-conditional-expectation-ice">Partial dependence plot (PDP) &amp; Individual conditional expectation (ICE)</h3>
<p>What is ICE? It is a plot that shows how a model makes predictions based on changing the value of one or more features, while keeping the values of other features constant. This provides us with more insights and understanding of how the model treats features to make predictions. ICE works per row (or per customer in this case), and PDP is simply the average of ICE.</p>
<div class="cell" data-execution_count="94">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pdp_ice_plot(model, df_test, column, clusters<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    df_test <span class="op">=</span> df_test.copy()</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    pdp_isolate <span class="op">=</span> pdp.PDPIsolate(model <span class="op">=</span> model, df <span class="op">=</span> df_test, </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                      num_grid_points<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                      model_features <span class="op">=</span> df_test.columns, </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                      feature <span class="op">=</span> column, feature_name<span class="op">=</span>column)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    pdp_isolate.plot(</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                center<span class="op">=</span><span class="va">True</span>, plot_lines<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                cluster<span class="op">=</span>clusters, n_cluster_centers<span class="op">=</span><span class="dv">5</span>,cluster_method<span class="op">=</span><span class="st">'accurate'</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>                plot_pts_dist<span class="op">=</span><span class="va">False</span>, to_bins<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                show_percentile<span class="op">=</span><span class="va">False</span>, which_classes<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>), dpi<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>                ncols<span class="op">=</span><span class="dv">2</span>, plot_params<span class="op">=</span>{<span class="st">"pdp_hl"</span>: <span class="va">True</span>},</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>                engine<span class="op">=</span><span class="st">'matplotlib'</span>, template<span class="op">=</span><span class="st">'plotly_white'</span>)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="95">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>pdp_ice_plot(rf, X_test, <span class="st">'MonthlyCharges'</span>, <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"04674fe01dd14bde8529e5e54c7c1f3f","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-94-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>The light blue lines represent ICE (Individual Conditional Expectation), and the yellowish blue line represents PDP (Partial Dependence Plot). The X-axis represents MonthlyCharges, while the Y-axis represents the change in prediction probability. At MonthlyCharges of 60.7 USD, you can observe that some customers experience a significant increase in churn probability as the MonthlyCharges increase. However, it is important to note that not all customers have the same response. Some customers are minimally affected, and some may not be affected at all.</p>
<div class="cell" data-execution_count="96">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>pdp_ice_plot(rf, X_test, <span class="st">'MonthlyCharges'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"64bb89d8bb49434d9ab1fe48bc1e7866","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-95-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>This is the same plot as above, but I have grouped the ICE into 5 clusters for easier viewing and analysis. You can see that there are some customers who experience a significant increase in churn probability as the MonthlyCharges increase.</p>
<div class="cell" data-execution_count="97">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>pdp_ice_plot(rf, X_test, <span class="st">'tenure'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"eca10db867eb433599ffd371253358d9","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-96-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>The longer the tenure, the lower the churn probability. However, the effect is not the same for all customers. Some customers are greatly affected, while others are barely affected.</p>
<div class="cell" data-execution_count="98">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>pdp_ice_plot(rf, X_test, <span class="st">'Contract'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"ffe94b164b3748e09a1fae6841a1f865","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-97-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>The same also goes with Contract. Longer contract means lower churn probability.</p>
<div class="cell" data-execution_count="99">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>X_test_copy <span class="op">=</span> X_test.copy()</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>pdp_interact <span class="op">=</span> pdp.PDPInteract(model<span class="op">=</span>rf, df<span class="op">=</span>X_test_copy,</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>                              num_grid_points<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>                              model_features <span class="op">=</span> X_test.columns, </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>                              features<span class="op">=</span>[<span class="st">'MonthlyCharges'</span>,<span class="st">'tenure'</span>], </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>                              feature_names<span class="op">=</span>[<span class="st">'MonthlyCharges'</span>,<span class="st">'tenure'</span>])</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>pdp_interact.plot(</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>            plot_type<span class="op">=</span><span class="st">"grid"</span>, plot_pdp<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>            to_bins<span class="op">=</span><span class="va">True</span>, show_percentile<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>            which_classes<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>),</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">300</span>, ncols<span class="op">=</span><span class="dv">2</span>, plot_params<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>            engine<span class="op">=</span><span class="st">'matplotlib'</span>, template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.
obtain pred_func from the provided model.
obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"0dc9192bc56345d8acbdf7ccf8a45d40","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c97c457ef4124592a4f6f0111a0fadf4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"43323cbd42fb4496af5e0897f0b53d16","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-98-output-5.png" class="img-fluid"></p>
</div>
</div>
<p>Let’s analyze the combination of MonthlyCharges and tenure. We can observe a spike in churn probability for MonthlyCharges ranging from 56.3 USD to 79.2 USD, particularly for customers with a tenure of less than 7 months.</p>
<div class="cell" data-execution_count="100">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>X_test_copy <span class="op">=</span> X_test.copy()</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>pdp_interact <span class="op">=</span> pdp.PDPInteract(model<span class="op">=</span>rf, df<span class="op">=</span>X_test_copy,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>                              num_grid_points<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                              model_features <span class="op">=</span> X_test.columns, </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                              features<span class="op">=</span>[<span class="st">'tenure'</span>,<span class="st">'Contract'</span>], </span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                              feature_names<span class="op">=</span>[<span class="st">'tenure'</span>,<span class="st">'Contract'</span>])</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>pdp_interact.plot(</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>            plot_type<span class="op">=</span><span class="st">"grid"</span>, plot_pdp<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>            to_bins<span class="op">=</span><span class="va">True</span>, show_percentile<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>            which_classes<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>),</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>            dpi<span class="op">=</span><span class="dv">300</span>, ncols<span class="op">=</span><span class="dv">2</span>, plot_params<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>            engine<span class="op">=</span><span class="st">'matplotlib'</span>, template<span class="op">=</span><span class="st">'plotly_white'</span>,</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>obtain pred_func from the provided model.
obtain pred_func from the provided model.
obtain pred_func from the provided model.</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"c89587cb85a4492aa1466083b8e75f04","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"89471e517b3b474d95b343f916b691f2","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"9a6eebc63c2d40d9947bd34b5db4e0bf","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-99-output-5.png" class="img-fluid"></p>
</div>
</div>
<p>The model produces similar churn probabilities for customers with a combination of a 2-year contract and low tenure compared to those with a month-to-month contract and medium tenure (24-36 months).</p>
<p>You can see how PDP and ICE plots can be very beneficial in understanding how the model utilizes features to make predictions. In the next section, I will demonstrate how to assess the model’s prediction confidence level.</p>
</section>
<section id="confidence-level-based-on-trees-standard-deviation-and-confidence-interval." class="level3">
<h3 class="anchored" data-anchor-id="confidence-level-based-on-trees-standard-deviation-and-confidence-interval.">Confidence level based on trees’ standard deviation and confidence interval.</h3>
<p>Tree-based models like RandomForest make predictions by using the mean of all the trees’ prediction probabilities. However, instead of solely relying on the mean, we can also calculate the standard deviation. A higher standard deviation indicates lower confidence in the predictions. Additionally, we can utilize confidence intervals, such as 95% or even more extreme at 99%.</p>
<div class="cell" data-execution_count="122">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract all trees' prediction probability per row</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>predict <span class="op">=</span> np.stack([x.predict_proba(X_test)[:,<span class="dv">1</span>] <span class="cf">for</span> x <span class="kw">in</span> rf.estimators_])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="123">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#assign mean and std. deviation of trees' prediction probability.</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>df_pred <span class="op">=</span> X_test.copy()</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>df_pred[<span class="st">'avg'</span>] <span class="op">=</span> np.<span class="bu">round</span>(np.mean(predict, axis <span class="op">=</span> <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>df_pred[<span class="st">'std_dev'</span>] <span class="op">=</span> np.<span class="bu">round</span>(np.std(predict, axis <span class="op">=</span> <span class="dv">0</span>) <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="124">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">6</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(df_pred[<span class="st">'std_dev'</span>],color<span class="op">=</span><span class="st">'skyblue'</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Standard deviation distribution'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-102-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Most of predictions have std.deviation under 10%. Let’s calculate confidence interval with 99%.</p>
<div class="cell" data-execution_count="125">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>df_pred[<span class="st">'CI-99%'</span>] <span class="op">=</span> (<span class="fl">2.576</span> <span class="op">*</span> df_pred[<span class="st">'std_dev'</span>] <span class="op">/</span> np.sqrt(<span class="bu">len</span>(predict))) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> (df_pred[<span class="st">'avg'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="127">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>df_pred[df_pred.avg <span class="op">&gt;</span> <span class="dv">40</span>].sort_values(<span class="st">'CI-99%'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="127">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">Fiber_optic</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">FO_LB</th>
<th data-quarto-table-cell-role="th">No_internet</th>
<th data-quarto-table-cell-role="th">avg</th>
<th data-quarto-table-cell-role="th">std_dev</th>
<th data-quarto-table-cell-role="th">CI-99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">852</td>
<td>2</td>
<td>7</td>
<td>1</td>
<td>94.05</td>
<td>1</td>
<td>0</td>
<td>40.06</td>
<td>25.08</td>
<td>10.199818</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">499</td>
<td>1</td>
<td>58</td>
<td>1</td>
<td>98.70</td>
<td>1</td>
<td>0</td>
<td>41.05</td>
<td>18.24</td>
<td>7.239149</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1186</td>
<td>1</td>
<td>59</td>
<td>1</td>
<td>101.10</td>
<td>1</td>
<td>0</td>
<td>40.37</td>
<td>16.73</td>
<td>6.751699</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1137</td>
<td>1</td>
<td>15</td>
<td>1</td>
<td>96.30</td>
<td>0</td>
<td>0</td>
<td>48.14</td>
<td>19.69</td>
<td>6.663701</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1184</td>
<td>1</td>
<td>10</td>
<td>1</td>
<td>92.50</td>
<td>0</td>
<td>0</td>
<td>48.17</td>
<td>19.12</td>
<td>6.466765</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s consider the example of row 1. The model predicts a 40% probability of churn for the customer, with a confidence interval of +- 10%. By default, the model’s output indicates that the customer will not churn. However, due to the high confidence interval, it is safer to assume that the customer will churn.</p>
<p><strong>Checking the standard deviation and confidence interval of the trees is extremely useful, particularly when the cost of ‘False Negative’ is significant and can have severe consequences.</strong></p>
</section>
</section>
</section>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/vertikalwil\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>